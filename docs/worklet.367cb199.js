!function(e,t,r,a,s,o,i,n){var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},u="function"==typeof l[a]&&l[a],d=u.i||{},c=u.cache||{},h="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function p(t,r){if(!c[t]){if(!e[t]){if(s[t])return s[t];var o="function"==typeof l[a]&&l[a];if(!r&&o)return o(t,!0);if(u)return u(t,!0);if(h&&"string"==typeof t)return h(t);var i=Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}d.resolve=function(r){var a=e[t][1][r];return null!=a?a:r},d.cache={};var n=c[t]=new p.Module(t);e[t][0].call(n.exports,d,n,n.exports,l)}return c[t].exports;function d(e){var t=d.resolve(e);return!1===t?{}:p(t)}}p.isParcelRequire=!0,p.Module=function(e){this.id=e,this.bundle=p,this.require=h,this.exports={}},p.modules=e,p.cache=c,p.parent=u,p.distDir=void 0,p.publicUrl=void 0,p.devServer=void 0,p.i=d,p.register=function(t,r){e[t]=[function(e,t){t.exports=r},{}]},Object.defineProperty(p,"root",{get:function(){return l[a]}}),l[a]=p;for(var f=0;f<t.length;f++)p(t[f]);if(r){var m=p(r);"object"==typeof exports&&"undefined"!=typeof module?module.exports=m:"function"==typeof define&&define.amd&&define(function(){return m})}}({"6bE6Q":[function(e,t,r,a){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"AudioTrackProcessor",()=>l);var o=e("@swc/helpers/_/_define_property"),i=e("../../lib/useBroadcast"),n=e("./types");class l extends AudioWorkletProcessor{static get parameterDescriptors(){return[{name:n.AudioTrackParameters.Gate,automationRate:"a-rate",defaultValue:0,minValue:0,maxValue:1},{name:n.AudioTrackParameters.Restart,automationRate:"k-rate",defaultValue:0,minValue:0,maxValue:1},{name:n.AudioTrackParameters.Loop,automationRate:"k-rate",defaultValue:0,minValue:0},{name:n.AudioTrackParameters.Start,automationRate:"k-rate",defaultValue:0,minValue:0},{name:n.AudioTrackParameters.End,automationRate:"k-rate",defaultValue:0,minValue:0},{name:n.AudioTrackParameters.Detune,automationRate:"k-rate",defaultValue:0},{name:n.AudioTrackParameters.PlaybackRate,automationRate:"k-rate"}]}emitProgressEvent(){this.cursor!==this.prevCursor&&(this.broadcast({name:"time",cursor:this.cursor,seconds:this.cursor/sampleRate,progress:this.data?this.cursor/this.data.length:0}),this.prevCursor=this.cursor)}useTrigger(e,t){for(let r=0;r<e.length;r++){let a=e[r];a>=.5&&!this.isTriggered&&(this.isTriggered=!0,t()),a<.5&&this.isTriggered&&(this.isTriggered=!1)}}useGate(e,t,r){for(let t=0;t<e.length;t++){let r=e[t];r>=.5&&!this.isPlaying&&(this.isPlaying=!0),r<.5&&this.isPlaying&&(this.isPlaying=!1)}this.isPlaying?t():r()}process(e,t,r){if(!this.data)return!0;let a=r[n.AudioTrackParameters.Gate],s=r[n.AudioTrackParameters.Loop],o=r[n.AudioTrackParameters.Start],i=r[n.AudioTrackParameters.End],l=r[n.AudioTrackParameters.Restart],u=r[n.AudioTrackParameters.Detune],d=r[n.AudioTrackParameters.PlaybackRate],[c,h,p,f]=t;return(o[0]!==this.prevStart||i[0]!==this.prevEnd)&&(this.prevStart=o[0],this.prevEnd=i[0],this.broadcast({name:"range",data:[o[0],i[0]||this.data.duration]})),p.forEach((e,t)=>{for(let t=0;t<e.length;t++)e[t]=this.data.duration}),this.useTrigger(l,()=>{this.cursor=o[0]*sampleRate}),this.useGate(a,()=>{let e=u[0],r=(d[0]||1)*Math.pow(2,e/1200),a=t[0][0].length;c.forEach((e,t)=>{let s=this.data.channelData[t];for(let t=0;t<a;t++){let a=this.cursor+t*r,o=Math.floor(a),i=o+1,n=s[o]||0,l=s[i]||0,u=a-o;e[t]=n+(l-n)*u}});let n=(i[0]||this.data.duration)*sampleRate,l=this.cursor+a*r;l>=n?1===s[0]?this.cursor=o[0]*sampleRate:this.cursor=n+1:l<=0?1===s[0]?this.cursor=n:this.cursor=0:this.cursor=l;let p=this.cursor>0&&this.cursor<n;h.forEach(e=>{e.fill(+p)}),this.emitProgressEvent()},()=>{h.forEach(e=>{e.fill(0)}),this.cursor=o[0]*sampleRate,this.emitProgressEvent()}),f.forEach((e,t)=>{for(let t=0;t<e.length;t++)e[t]=this.cursor/sampleRate}),!0}constructor(){super(),(0,o._)(this,"data",null),(0,o._)(this,"prevGateState",!1),(0,o._)(this,"isTriggered",!1),(0,o._)(this,"isPlaying",!1),(0,o._)(this,"cursor",0),(0,o._)(this,"prevCursor",0),(0,o._)(this,"prevStart",null),(0,o._)(this,"prevEnd",null),(0,o._)(this,"broadcast",(0,i.useBroadcast)(this.port)),this.port.start(),this.port.onmessage=({data:e})=>{"track"===e.name&&(this.data=e.data,this.broadcast({name:"track",data:e.data})),"data-chunk"===e.name&&(this.data||(this.data={duration:0,length:0,sampleRate:sampleRate,channelData:[new Float32Array(0),new Float32Array(0)]}),this.data.channelData.forEach((t,r)=>{let a=e.data[r]||e.data[0],s=new Float32Array(t.length+a.length);s.set(t),s.set(a,t.length),this.data.channelData[r]=s}),this.data.length=this.data.channelData[0].length,this.data.duration=this.data.length/this.data.sampleRate,this.broadcast({name:"track",data:this.data}))}}}try{registerProcessor("audio-track-processor",l)}catch(e){}},{"@swc/helpers/_/_define_property":"dIIHJ","../../lib/useBroadcast":"eLhYv","./types":"hGTaH","@parcel/transformer-js/src/esmodule-helpers.js":"c8FVb"}],dIIHJ:[function(e,t,r,a){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}s.defineInteropFlag(r),s.export(r,"_",()=>o)},{"@parcel/transformer-js/src/esmodule-helpers.js":"c8FVb"}],c8FVb:[function(e,t,r,a){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach(function(r){"default"===r||"__esModule"===r||Object.prototype.hasOwnProperty.call(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})}),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}],eLhYv:[function(e,t,r,a){var s,o,i=e("@parcel/transformer-js/src/esmodule-helpers.js");i.defineInteropFlag(r),i.export(r,"Events",()=>o),i.export(r,"useBroadcast",()=>l),i.export(r,"addBroadcastListener",()=>u),i.export(r,"removeBroadcastListener",()=>d),(s=o||(o={})).ADD_LISTENER="ADD_LISTENER",s.REMOVE_LISTENER="REMOVE_LISTENER";let n="default",l=e=>{let t={[n]:[]};return e.addEventListener("message",({data:e})=>{var r,a;if("ADD_LISTENER"===e.name){let a=null!=(r=e.poolName)?r:n;t[a]||(t[a]=[]),t[a].push(e.port)}if("REMOVE_LISTENER"===e.name){let r=null!=(a=e.poolName)?a:n;t[r]||(t[r]=[]),t[r].push(e.port)}}),(e,r=n)=>{var a;return null==(a=t[r])?void 0:a.forEach(t=>t.postMessage(e))}},u=(e,t,r)=>{e.postMessage({name:"ADD_LISTENER",port:t,poolName:r},[t])},d=(e,t,r)=>{e.postMessage({name:"REMOVE_LISTENER",poolName:r},[])}},{"@parcel/transformer-js/src/esmodule-helpers.js":"c8FVb"}],hGTaH:[function(e,t,r,a){var s,o,i=e("@parcel/transformer-js/src/esmodule-helpers.js");i.defineInteropFlag(r),i.export(r,"AudioTrackParameters",()=>o),(s=o||(o={})).Gate="gate",s.Restart="restart",s.Loop="loop",s.Start="start",s.End="end",s.Detune="detune",s.PlaybackRate="playbackRate"},{"@parcel/transformer-js/src/esmodule-helpers.js":"c8FVb"}]},["6bE6Q"],"6bE6Q","parcelRequirec6d8",{});
//# sourceMappingURL=worklet.367cb199.js.map
